<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>slt ALU</title>
<!-- 2017-03-23 四 04:25 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="鄭景文" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<style type="text/css">
* {
    font-family:WenQuanYi Micro Hei,Microsoft JhengHei,Helvetica,sans-serif;
    color: #555555;
    }

body {
    text-align: center;
    background-color: hsl(45,30%,80%);
    background-image:
    repeating-linear-gradient(120deg, rgba(255,255,255,.1), rgba(255,255,255,.1) 2px, transparent 1px, transparent 60px),
    repeating-linear-gradient(60deg, rgba(255,255,255,.1), rgba(255,255,255,.1) 2px, transparent 1px, transparent 60px),
    linear-gradient(60deg, rgba(0,0,0,.06) 25%, transparent 25%, transparent 75%, rgba(0,0,0,.06) 75%, rgba(0,0,0,.06)),
    linear-gradient(120deg, rgba(0,0,0,.06) 25%, transparent 25%, transparent 75%, rgba(0,0,0,.06) 75%, rgba(0,0,0,.06));
    background-size: 70px 120px;
}

#content {
    margin: 0px auto;
    width: 1200px;
    text-align:left;
    background-color: rgba(255, 255, 255, 1);
    border-radius: 7px 7px 0 0;
    box-shadow: 0 0 0.5em rgba(0,0,0,0.2);
    padding-bottom: 30px;
}

#content > p {
    padding-left: 60px;
}


#postamble {
    position: relative;
    z-index: 1;
    font-size:0.8em;
    color: #ffffff !important;
    background-color: #555555 !important;
    margin: -1.2em auto 0;
    width: 1180px;
    background-color: #ffffff;
    border-radius: 0 0 7px 7px;
    padding: 30px 10px 10px 10px;
    box-shadow: 0 0 0.5em rgba(0,0,0,0.2);
    text-shadow: 0px -1px rgba(0, 0, 0, 0.3);

    background-color: #828282;
    background-image: radial-gradient(#707070 50%, transparent 51%);
    background-size: 4px 4px;
}
#postamble p {
    margin: 0;
    color: #eeeeee !important;
}

#postamble a {
    color: #5fafd7;
}

#table-of-contents {
    margin: 0 30px;
    padding: 0 15px 10px 15px;
    border-top: 4px solid #D4DDE0;
    border-bottom: 4px solid #D4DDE0;
    background-color: #E9EEF1;
    text-shadow: 0 1px 0 hsl(202,100%,100%);
}

#table-of-contents h2 {
    color: hsl(202,40%,52%);
    text-shadow: 0 1px 0 hsl(202,100%,100%);
    border-left: none;
    margin-left: 0;
    padding-left: 0;
}

img {
    max-width:100%;
    max-height:100%;
}
a {
    color: #005f87;
    text-decoration: none;
}

a:hover {
    color: #005f87;
    text-decoration: underline;
}

h1 {
    color: #eeeeee;
    text-shadow: 0px -1px rgba(0, 0, 0, 0.5);
    font-family: Lato,Lucida Grande,LiHei Pro,WenQuanYi Micro Hei,Arial,sans-serif;
    font-weight: 400;
    margin-top: 0px;
    padding: 20px 0 10px 0;
    background-color: #828282;
    background-image: radial-gradient(#707070 50%, transparent 51%);
    background-size: 4px 4px;
    border-radius: 7px 7px 0 0;
}
h2 {
    color: #777;
    border-left: 5px solid #777;
    margin-left: -30px;
    padding-left: 25px;
}

.outline-2 { padding: 0px 30px; }
.outline-3 { padding: 0px 30px; }

.outline-text-2 { padding: 0px 0px; }
.outline-text-3 { padding: 0px 0px; }
.example { }
pre {
    border: 1pt solid #ddd;
    background-color: #f2f2f2;
    box-shadow: 0 0 1em rgba(0,0,0,0.05);
    border-radius:5px;
    padding: 5pt;
    font-family: courier, monospace;
    font-size: 90%;
    overflow:auto;
    margin: 0.5em 2em;
}

pre.src:before {
    background-color: rgba(0, 0, 0, 0.5);
    color: #fff;
    border-radius: 5px;
    border: none;
    top: -10px;
    right: 10px;
    padding: 3px 7px;
    position: absolute;
}

code {
    border: 1pt solid #ddd;
    background-color: #eee;
    padding: 0 3px;
    border-radius: 3px;
    position: relative;
    margin-top: -3px;
    font-family: courier, monospace;
    font-size: 80%;
}

blockquote {
    font-style:italic;
    background: hsl(44,80%,95%);
    border-left: 5px solid hsl(44,25%,70%);
    margin: 1.5em 2em;
    padding: 0.5em 10px 0.5em 4em;
    quotes: '\201C''\201D''\2018''\2019';
}
blockquote:before {
    color: #ccc;
    position: absolute;
    margin-top: -0.03em;
    margin-left: -1.3em;
    color: hsl(44,25%,85%);
    font-size: 5em;
    content: '\201C' !important;
}
blockquote p {
    display: inline;
    font-family:'Times New Roman', Times, serif !important;
}
blockquote p a {
    font-family:'Times New Roman', Times, serif !important;
      }

.done {
    background-color: #d7ff87;
    color: #008700;
    border: 1px solid #5faf00;
    border-radius: 3px;
    padding:0px 2px;
    top: -1px;
    position: relative;
    font-family:WenQuanYi Micro Hei,Microsoft JhengHei,Helvetica,sans-serif;
    font-weight: bold;
    font-size:0.8em;
}
.todo {
    background-color: #ffafaf;
    color: #a40000;
    border: 1px solid #dd0000;
    border-radius: 3px;
    padding:0px 2px;
    top: -1px;
    position: relative;
    font-family:WenQuanYi Micro Hei,Microsoft JhengHei,Helvetica,sans-serif;
    font-weight: bold;
    font-size:0.8em;
}
.tag { float:right; color:red; }

h2.footnotes {
    margin-left: 0;
}
#text-footnotes {
    margin-left: 30px;
}

</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">slt ALU</h1>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> 實作內容說明</h2>
<div class="outline-text-2" id="text-1">

<div class="figure">
<p><img src="./img/basic_command.png" alt="basic_command.png" />
</p>
</div>

<p>
首先實作 AND 與 OR 的功能, 在 input 前透過一個是否 invert 的 bit 就可以同時做出 NAND 與 NOR
</p>

<p>
同理, 利用這種做法我們只要實作加法則減法也做完了
</p>
</div>
<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> adder</h3>
<div class="outline-text-3" id="text-1-1">
</div><div id="outline-container-sec-1-1-1" class="outline-4">
<h4 id="sec-1-1-1"><span class="section-number-4">1.1.1</span> carry look ahead</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
原本透過 ripple carry adder 來實做加法時, cout 必須等待前一位的加法進位 (cin) 完成才能夠做運算, 於是會造成延遲
</p>

<p>
所以改用 carry look ahead 的方式, 意思是說 每一個 C<sub>in</sub> 其實都可以透過前面的 A<sub>(i-1)</sub>, B<sub>(i-1)</sub> &#x2026; A<sub>0</sub>, B<sub>0</sub> 直接算出來,
</p>


<p>
於是 cout 就可以不用透過等待前面的 C<sub>in</sub> 來算, 不過就需要額外的 carry look ahead circuit 來計算每一個 bit 的 carry out
</p>


<div class="figure">
<p><img src="./img/4cla.png" alt="4cla.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-1-2" class="outline-4">
<h4 id="sec-1-1-2"><span class="section-number-4">1.1.2</span> 32 bit carry look ahead adder</h4>
<div class="outline-text-4" id="text-1-1-2">
<p>
在這邊我們實作了一個 8 bit 的 carry look ahead circuit (cla) , 並將他串起來做成一個 32 bit adder, 
但是這樣的話在彼此的 carry 傳遞過程中又會有 ripple 造成延遲
</p>


<div class="figure">
<p><img src="./img/32badder.png" alt="32badder.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-sec-1-1-3" class="outline-4">
<h4 id="sec-1-1-3"><span class="section-number-4">1.1.3</span> multiple level carry look ahead adder</h4>
<div class="outline-text-4" id="text-1-1-3">
<p>
於是我們在這之上再建了一層 cla, 事先將每一個 8 bit cla 需要得 carry<sub>in</sub> 算出來, 減少延遲, 也就是 multiple level cla 
</p>


<div class="figure">
<p><img src="./img/multicladder.png" alt="multicladder.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-1-4" class="outline-4">
<h4 id="sec-1-1-4"><span class="section-number-4">1.1.4</span> Reference</h4>
<div class="outline-text-4" id="text-1-1-4">
<p>
<a href="http://ithelp.ithome.com.tw/articles/10160513">iT 邦幫忙：淺入淺出計組之旅</a>
</p>

<p>
<a href="https://chi_gitbook.gitbooks.io/personal-note/content/addition.html">chi＿gitbook</a>
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> ZCV flag</h3>
<div class="outline-text-3" id="text-1-2">
</div><div id="outline-container-sec-1-2-1" class="outline-4">
<h4 id="sec-1-2-1"><span class="section-number-4">1.2.1</span> check zero</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
將 result 的所有位數拿出來做 nor 
</p>
</div>
</div>

<div id="outline-container-sec-1-2-2" class="outline-4">
<h4 id="sec-1-2-2"><span class="section-number-4">1.2.2</span> check carry out</h4>
<div class="outline-text-4" id="text-1-2-2">
<p>
由 cla adder 拿出 carry out 之後, 再確認是否是作加減法
</p>
</div>
</div>

<div id="outline-container-sec-1-2-3" class="outline-4">
<h4 id="sec-1-2-3"><span class="section-number-4">1.2.3</span> check overflow</h4>
<div class="outline-text-4" id="text-1-2-3">
<p>
考慮加法會 overflow 的情況, 當兩數同號的時候有可能會 overflow, 
</p>

<ol class="org-ol">
<li>考慮正：overflow 成負數, MSB = 1, 第 32 bit 有 carry<sub>in</sub> 沒有 carry<sub>out</sub>
</li>
<li>考慮負：overflow 成正數, MSB = 0, 第 32 bit 有 carry<sub>out</sub> 沒有 carry<sub>in</sub>
</li>
<li>otherwise：第 32 bit 有 carry<sub>in</sub> 就會有 carry<sub>out</sub>, vise versa
</li>
</ol>

<p>
得到：當第 32 bit carry<sub>in</sub> 與 carry<sub>out</sub> 不同時就是 overflow
</p>

<p>
而減法可以 mapping 回加法所以就推論完了
</p>
</div>
</div>

<div id="outline-container-sec-1-2-4" class="outline-4">
<h4 id="sec-1-2-4"><span class="section-number-4">1.2.4</span> Reference</h4>
<div class="outline-text-4" id="text-1-2-4">
<p>
<a href="https://chi_gitbook.gitbooks.io/personal-note/content/alu.html">chi＿gitbook</a>
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> set command</h3>
<div class="outline-text-3" id="text-1-3">

<div class="figure">
<p><img src="./img/set_command.png" alt="set_command.png" />
</p>
</div>
</div>

<div id="outline-container-sec-1-3-1" class="outline-4">
<h4 id="sec-1-3-1"><span class="section-number-4">1.3.1</span> slt (set less than)</h4>
<div class="outline-text-4" id="text-1-3-1">
<p>
同號時考慮減法出來的結果, MSB = 1 則 lt = 1, 異號時只要 A MSB = 1 則 lt = 1
</p>
</div>
</div>

<div id="outline-container-sec-1-3-2" class="outline-4">
<h4 id="sec-1-3-2"><span class="section-number-4">1.3.2</span> seq (set equal)</h4>
<div class="outline-text-4" id="text-1-3-2">
<p>
將加法中的每個 xor 的結果拿出來再做 and, 由於 instruction 的設計, 出來的是 1 代表 A, B 每一位都相同, 所以相等
</p>
</div>
</div>

<div id="outline-container-sec-1-3-3" class="outline-4">
<h4 id="sec-1-3-3"><span class="section-number-4">1.3.3</span> other set command (sgt, sle, sge, sne)</h4>
<div class="outline-text-4" id="text-1-3-3">
<p>
現在我們有 lt, eq 兩個指標了, 其他的條件都可以用這兩個組出來, 我們希望使用的邏輯單元越少越好, 於是我們讓所有的 set command 在 alu 裡共用一條線路,
</p>

<p>
只在外面做判斷, 首先觀察 control input 三個 bit, 我們可以發現 MSB 代表只考慮 eq , 中間代表加入考慮 eq, LSB 代表 考慮 lt, 
</p>

<p>
於是我們可以得到 set = <code>(~[2]) &amp; ([0] ^ lt) | ([1] &amp; eq)</code> 這條式子, 接進 LSB 的 alu 就完成了
</p>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: 鄭景文</p>
<p class="date">Created: 2017-03-23 四 04:25</p>
<p class="creator">Emacs 25.1.1 (Org mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
